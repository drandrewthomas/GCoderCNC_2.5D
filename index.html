<!DOCTYPE html>
<html lang="en">
<head>
  <title>SVG G-Code Maker</title>
  <meta name="mobile-web-app-capable" content="yes" />
  <meta content="yes" name="apple-mobile-web-app-capable" />
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
  <meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="./code/variables.js"></script>
  <script src="./code/utilities.js"></script>
  <script src="./code/svgparsing.js"></script>
  <script src="./code/gcodemaker.js"></script>
  <script src="./code/svg2gcode.js"></script>
  <script src="./libraries/quicksettings.min.js"></script>
  <link rel="stylesheet" type="text/css" href="./code/svg2gcode.css">
</head>
<body onLoad="init()">
<div id="outercontainer">

<nav class="navbar navbar-expand navbar-expand-sm navbar-light navbar-fixed-top cncnavbar">
  <!-- Brand -->
  <a class="navbar-brand navbarbrand" href="#">GCoderCNC 2.5D</a>
  <ul class="navbar-nav">
    <!-- Dropdown -->
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle navbaritems" href="#" id="navbardrop" data-toggle="dropdown">Import</a>
      <div class="dropdown-menu">
        <a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" onClick="openimportdialog()">Import SVG...</a>
      </div>
    </li>
    <!-- Dropdown -->
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle navbaritems" href="#" id="navbardrop" data-toggle="dropdown">Export</a>
      <div class="dropdown-menu">
        <a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" onClick="opengcodedialog()">Export G-Code...</a>
        <a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" onClick="opensvgexportdialog()">Export SVG file...</a>
      </div>
    </li>
    <!-- Dropdown -->
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle navbaritems" href="#" id="navbardrop" data-toggle="dropdown">CNC mode</a>
      <div class="dropdown-menu">
        <a id="rmode" class="dropdown-item navbardropdownitems" href="#" onClick="setcncmode(0)">✓ Router mode (with depth)</a>
        <a id="lmode" class="dropdown-item navbardropdownitems" href="#" onClick="setcncmode(1)">LASER mode (no depth)</a>
      </div>
    </li>
    <!-- Dropdown -->
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle navbaritems" href="#" id="navbardrop" data-toggle="dropdown">XY origin</a>
      <div class="dropdown-menu">
        <a id="origin0" class="dropdown-item navbardropdownitems" href="#" onClick="setcncorigin(0)">✓ Bottom left</a>
        <a id="origin1" class="dropdown-item navbardropdownitems" href="#" onClick="setcncorigin(1)">Top left</a>
        <a id="origin2" class="dropdown-item navbardropdownitems" href="#" onClick="setcncorigin(2)">Bottom right</a>
        <a id="origin3" class="dropdown-item navbardropdownitems" href="#" onClick="setcncorigin(3)">Top right</a>
        <a id="origin4" class="dropdown-item navbardropdownitems" href="#" onClick="setcncorigin(4)">Middle</a>
      </div>
    </li>
    <!-- Dropdown -->
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle navbaritems" href="#" id="navbardrop" data-toggle="dropdown">Examples</a>
      <div class="dropdown-menu">
        <a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" onClick="opensamplesdialog()">Open an example SVG file...</a>
        <a id="projectlink" class="dropdown-item navbardropdownitems" href="" target="_blank">Visit this examples web page</a>
      </div>
    </li>
  </ul>
  <ul class="navbar-nav ml-auto">
    <!-- Dropdown -->
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle navbaritems" href="#" id="navbardrop" data-toggle="dropdown">Help</a>
      <div class="dropdown-menu dropdown-menu-right">
        <a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" data-target="#aboutdialog">About...</a>
        <a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" data-target="#privacydialog">Privacy...</a>
        <a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" data-target="#refreshdialog">Refresh this app...</a>
        <a class="dropdown-item navbardropdownitems" href="https://github.com/drandrewthomas/GCoderCNC_2.5D" target="_blank">Visit the Github page</a>
        <a class="dropdown-item navbardropdownitems" href="https://www.cncmakerzone.co.uk" target="_blank">Visit CNCMakerZone.co.uk</a>
      </div>
    </li>
  </ul>
</nav>

<!-- SVG file import dialog -->
<div id="importsvgfiledialog" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header cncmodalheader">
        <h4 class="modal-title">Open an SVG file</h4>
        <button type="button" class="close cncmodalcross" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body cncmodalbody">
        <p>Click the 'choose file' button below to import your design, making sure the file is a valid Scalable Vector Graphics (SVG) file.</p>
        <input id="svgfile" class="form-control-file border svgimportcontrol" name="svgfile" type="file" onchange="svgfilechanged()" />
      </div>
      <div class="modal-footer cncmodalfooter">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button id="importbutton" type="button" class="btn btn-danger" data-dismiss="modal" onClick="dofileselected()">Open file</button>
      </div>
    </div>
  </div>
</div>

<!-- Wrong import file dialog -->
<div id="svgproblemdialog" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header cncmodalheader">
        <h4 class="modal-title">SVG file import error!</h4>
        <button type="button" class="close cncmodalcross" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body cncmodalbody">
        <p>An error occurred trying to open a file. Perhaps you chose one that isn't an SVG file, or you may not even have chosen a file.</p>
        <p>Please try again and make sure you select a valid SVG file to import.</p>
      </div>
      <div class="modal-footer cncmodalfooter">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- GCode file save dialog -->
<div id="savegcodefiledialog" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered" style="width: 800px;">
    <div class="modal-content">
      <div class="modal-header cncmodalheader">
        <h4 class="modal-title">Export a G-Code file</h4>
        <button type="button" class="close cncmodalcross" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body cncmodalbody">
        <p>To generate a G-Code file to download you just need to provide a few details below about your project.</p>
        <div id="gcodeerror">
          <p class='gcodeerror'>Oh dear, there seems to be a problem with the values you entered. Please check them and try again.</p>
        </div>
        <div class="row" style="width: 90%; margin: auto;">
          <div class="col text-center">
            Width (mm): <input id="ncwidth" type="number" name="quantity" min="0" max="2000" step="0.1" oninput="dialogwidthchanged('ncwidth','ncheight')">
          </div>
          <div class="col text-center">
            GRBL version:
            <select id="grblmode" name="grblmode">
              <option value="Speed 0 to 1000" selected>Speed 0 to 1000</option>
              <option value="Speed 0 to 255">Speed 0 to 255</option>
            </select>
          </div>
        </div>
        <br />
        <div class="row" style="width: 90%; margin: auto;">
          <div class="col text-center">
            Height (mm): <input id="ncheight" type="number" name="quantity" min="0" max="2000" step="0.1" oninput="dialogheightchanged('ncwidth','ncheight')">
          </div>
          <div class="col text-center">
            <div id="safezdiv">
              Safe Z offset (mm): <input id="safez" type="number" name="quantity" min="0" max="100" step="0.1" value="0">
            </div>
          </div>
        </div>
        <br />
      </div>
      <div class="modal-footer cncmodalfooter">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" onClick="generategcode()">Download the G-Code</button>
      </div>
    </div>
  </div>
</div>

<!-- SVG file save dialog -->
<div id="savesvgfiledialog" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered" style="width: 800px;">
    <div class="modal-content">
      <div class="modal-header cncmodalheader">
        <h4 class="modal-title">Export an SVG file</h4>
        <button type="button" class="close cncmodalcross" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body cncmodalbody">
        <p>To generate an SVG file to download you just need to provide a few details below about your project.</p>
        <div id="svgexporterror">
          <p class='gcodeerror'>Oh dear, there seems to be a problem with the values you entered. Please check them and try again.</p>
        </div>
        <div class="row" style="width: 90%; margin: auto;">
          <div class="col text-center">
            Width (mm): <input id="svgncwidth" type="number" name="quantity" min="0" max="2000" step="0.1" oninput="dialogwidthchanged('svgncwidth','svgncheight')">
          </div>
          <div class="col text-center">
            Height (mm): <input id="svgncheight" type="number" name="quantity" min="0" max="2000" step="0.1" oninput="dialogheightchanged('svgncwidth','svgncheight')">
          </div>
        </div>
      </div>
      <div class="modal-footer cncmodalfooter">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" onClick="generatesvgexport()">Download the SVG file</button>
      </div>
    </div>
  </div>
</div>

<!-- About dialog -->
<div id="aboutdialog" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header cncmodalheader">
        <h4 class="modal-title"><div id="abouttitle"></div></h4>
        <button type="button" class="close cncmodalcross" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body cncmodalbody">
        <p>GCoderCNC 2.5D is a completely free and open source web app for creating G-Code files from SVG graphics, such as the ones you can create using Inkscape. Once you load an SVG file you can choose between router and LASER modes to suit your CNC machine and project type.</p>
        <p>While it is designed to make creating CNC G-Code as easy as possible, GCoderCNC 2.5D includes many advanced features to ensure you can use it for some very creative projects. For instance, it allows you to do things like setting different depths of cut, or LASER powers, for individual elements. And for routing it even lets you vary the cut depth for simple v-carving!</p>
        <p>Best of all, this app doesn't upload your designs or data to a server, or use cookies, so you can keep all your work on your own computer. And even better, it's designed for use on all PCs, web-browsers and tablets that support HTML5 apps (although not for phones).</p>
      </div>
      <div class="modal-footer cncmodalfooter">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Privacy dialog -->
<div id="privacydialog" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header cncmodalheader">
        <h4 class="modal-title">About GCoderCNC privacy</h4>
        <button type="button" class="close cncmodalcross" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body cncmodalbody">
        <p>GCoderCNC works entirely in your browser or as a web-app on your home screen or desktop. None of your files are uploaded to a server while you use this software.</p>
        <p>Also, no private data about you or your files is collected or transmitted by this software and no cookies are used. As all files are only used in the browser they should be as safe as other files stored on your computer.</p>
        <p>However, please note that, as described in the license file, you use this software at your own risk.</p>
      </div>
      <div class="modal-footer cncmodalfooter">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Samples dialog -->
<div id="samplesdialog" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header cncmodalheader">
        <h4 class="modal-title">Example SVG files for you to try</h4>
        <button type="button" class="close cncmodalcross" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body cncmodalbody" style="height: 500px; max-height: 500px !important;">
        <div id="samplescontainer" class="container samplesocntainer">
          <div class="row">
            <div class="col-sm">
              <div id="sampleslist" class ="sampleslist"></div>
            </div>
            <div class="col-sm lefttext">
              <div id="samplesdescription" class ="samplesdescription lefttext"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer cncmodalfooter">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" onClick="openthissample()">Open this example</button>
      </div>
    </div>
  </div>
</div>

<!-- Refresh WebAPp dialog -->
<div id="refreshdialog" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header cncmodalheader">
        <h4 class="modal-title">Refreshing this Web App</h4>
        <button type="button" class="close cncmodalcross" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body cncmodalbody">
        <p>If you are having difficulties with this Web App, or believe it is out of date, you can choose to refresh it. That will cause all of the application files to be re-downloaded from the internet so may take a little while. Once done you should have the latest version to enjoy :-)</p>
      </div>
      <div class="modal-footer cncmodalfooter">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" onClick="refreshwebapp()">Refresh now</button>
      </div>
    </div>
  </div>
</div>

<div id="appcontainer">
  <canvas id="svgcanvas" width="1" height="1"></canvas>
</div>

</div>

</body>
</html>
