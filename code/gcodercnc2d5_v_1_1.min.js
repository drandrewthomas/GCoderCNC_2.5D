$(window).on("load",function(){var a,c=0;loadsettingslocally();makesamplesdropdown();makethemesdropdown();loadtheme();createsettings();cnccanvas=$("#svgcanvas");cnccanvas.on("mouseleave",onMouseLeave);cnccanvas.on("mouseup",onMouseUp);cnccanvas.on("mousedown",onMouseDown);cnccanvas.on("mousemove",onMouseMove);$(window).on("resize",onResize);$(window).on("beforeunload",onUnloading);var b=getQueryVariable("open");if(!1!==b){c=-1;for(a=0;a<svgsamples.length;a++)if(b.trim().valueOf()===svgsamples[a][1]){c=
a;break}-1===c&&(console.log("Couldn't open "+b.trim().valueOf()),c=0)}layoutapp();$("#abouttitle").text("About GCoderCNC v"+mainversion+"."+subversion);loadsample(c)});function changetheme(a){a!==theme&&(theme=a,makethemesdropdown(),loadtheme(),savesettingslocally(),drawtocanvas("svgcanvas"))}
function loadtheme(){canvascol=themes[theme][6];normalline=themes[theme][7];selectedline=themes[theme][8];overriddenline=themes[theme][9];originline=themes[theme][10];notinlist=themes[theme][11];$(".cncnavbar").css("background-color",themes[theme][1]);$(".navbaritems").css("color",themes[theme][2]);$(".cncmodalheader").css("color",themes[theme][2]);$(".cncmodalheader").css("background-color",themes[theme][1]);$(".cncmodalbody").css("background-color",canvascol);$(".cncmodalfooter").css("background-color",
themes[theme][1]);$("#appcontainer").css("background-color",themes[theme][4]);$(".sampledesctext").css("color",themes[theme][5]);$(".cncmodalbody").css("color",themes[theme][5]);$(".gcodeerror").css("color",themes[theme][5]);$(".navbarbrand").css("color",themes[theme][3]);$(".navbardropdownmenu").css("background-color",themes[theme][1]);$(".navbardropdownitems").css("color",themes[theme][2])}
function createsettings(){defaultsettings=QuickSettings.create(0,5,"Default settings",document.getElementById("appcontainer"));defaultsettings.addRange("Default feed rate (mm/min)",10,500,defaultfeed,10);defaultsettings.addRange("Default spindle speed (%)",0,100,defaultspeed,5);defaultsettings.addNumber("Default depth (mm)",.2,50,1,.1);defaultsettings.addNumber("Default passes (nr)",1,100,1,1);defaultsettings.addDropDown("Default bottom profile",bottomprofilelist);defaultsettings.addDropDown("Default group",
["First","Second","Third","Fourth","Last"]);defaultsettings.setWidth(250);defaultsettings.hide();selectsettings=QuickSettings.create(0,5,"Edit selection",document.getElementById("appcontainer"));selectsettings.addButton("Reverse path direction",reverseselectedpath);selectsettings.addBoolean("Include in cutting list",!0,cutlistchanged);selectsettings.addBoolean("Override defaults",!1,overridechanged);selectsettings.addRange("Override feed rate (mm/min)",10,500,10,overridevalueschanged);selectsettings.addRange("Override spindle speed (%)",
0,100,5,overridevalueschanged);selectsettings.addNumber("Override depth (mm)",.2,50,1,.1,overridevalueschanged);selectsettings.addNumber("Override passes (nr)",1,100,1,1,overridevalueschanged);selectsettings.addDropDown("Override bottom profile",bottomprofilelist,overridevalueschanged);selectsettings.addDropDown("Override group",["First","Second","Third","Fourth","Last"]);selectsettings.setWidth(250);selectsettings.hide()}
function loadsample(a){commands=[];transforms=[];filename=svgsamples[a][1];projecturl=svgsamples[a][8];""!==projecturl?($("#projectlink").attr("href",projecturl),$("#projectlink").show()):$("#projectlink").hide();svgin=svgsamples[a][6];cleansvg();parsesvg();getbounds();moveto(0,0);cutterwidth=xmax-xmin;cutterheight=ymax-ymin;cutteraspect=cutterwidth/cutterheight;cutterwidth=svgsamples[a][4];cutterheight=cutterwidth/cutteraspect;1===svgsamples[a][2]?setcncmode(1):setcncmode(0);defaultsettings.show();
loaded=!0;layoutapp();drawtocanvas("svgcanvas");setsvgtexts()}function loadfile(a){projecturl="";$("#projectlink").hide();commands=[];transforms=[];svgin=a.target.result;cleansvg();parsesvg();getbounds();moveto(0,0);cutterwidth=xmax-xmin;cutterheight=ymax-ymin;cutteraspect=cutterwidth/cutterheight;defaultsettings.show();loaded=!0;layoutapp();drawtocanvas("svgcanvas");setsvgtexts()}
function dofileselected(){var a=document.getElementById("svgfile");if(0===a.files.length)$("#svgproblemdialog").modal("show");else{var c=a.files[0].name;fext=c.substr(c.lastIndexOf(".")+1).toLowerCase();"svg"!==fext?$("#svgproblemdialog").modal("show"):(filename=c.substr(0,c.lastIndexOf(".")),c=new FileReader,c.addEventListener("load",loadfile,!1),c.readAsText(a.files[0]))}}function settext(a){document.getElementById("mytext").innerHTML=a}
function drawtocanvas(a){a=document.getElementById(a).getContext("2d");var c=a.canvas.width;var b=a.canvas.height;sc=(c-10)/(xmax-xmin);switch(originpos){case 0:var d=5;var e=b-5;break;case 1:e=d=5;break;case 2:d=c-5;e=b-5;break;case 3:d=c-5;e=5;break;case 4:d=c/2,e=b/2}a.fillStyle=canvascol;a.fillRect(0,0,c,b);a.strokeStyle=originline[0];0===originline[1]?a.setLineDash([]):a.setLineDash([5,5]);a.moveTo(0,50);a.lineWidth=originline[2];a.beginPath();a.moveTo(d,0);a.lineTo(d,a.canvas.height);a.stroke();
a.beginPath();a.moveTo(0,e);a.lineTo(a.canvas.width,e);a.stroke();a.setLineDash([]);a.lineWidth=1;a.lineCap="square";handles=[];for(d=0;d<commands.length;d++)if("L"===commands[d][0]){var f=commands[d][1];c=f[0][0]*sc;b=f[0][1]*sc;handles.push([c,b]);a.beginPath();a.strokeStyle=0===commands[d][6]?notinlist[0]:1===commands[d][8]?overriddenline[0]:normalline[0];a.arc(c+5,b+5,4,0,2*Math.PI,!1);a.fill();a.stroke()}a.lineWidth=1;a.lineCap="square";for(d=0;d<commands.length;d++)if("L"===commands[d][0]){f=
commands[d][1];for(e=0;e<f.length;e++)c=f[e][0]*sc,b=f[e][1]*sc,0===e?(0===commands[d][6]?(a.strokeStyle=notinlist[0],0===notinlist[1]?a.setLineDash([]):a.setLineDash([5,5]),a.lineWidth=notinlist[2]):1===commands[d][8]?(a.strokeStyle=overriddenline[0],0===overriddenline[1]?a.setLineDash([]):a.setLineDash([5,5]),a.lineWidth=overriddenline[2]):(a.strokeStyle=normalline[0],0===normalline[1]?a.setLineDash([]):a.setLineDash([5,5]),a.lineWidth=normalline[2]),a.beginPath(),a.moveTo(c+5,b+5)):a.lineTo(c+
5,b+5);a.stroke()}if(0<=selhand){f=commands[selhand][1];for(e=0;e<f.length;e++)c=f[e][0]*sc,b=f[e][1]*sc,0===e?(a.strokeStyle=selectedline[0],0===selectedline[1]?a.setLineDash([]):a.setLineDash([5,5]),a.lineWidth=selectedline[2],a.lineWidth=5,a.beginPath(),a.moveTo(c+5,b+5)):a.lineTo(c+5,b+5);a.stroke();a.setLineDash([]);a.lineWidth=1}}function downloadcncfile(){var a=filename+".nc",c=makecnctext();a=new File([c],a,{type:"text/plain;charset=utf-8"});saveAs(a)}
function getdefaults(){defaultfeed=defaultsettings.getValue("Default feed rate (mm/min)");defaultspeed=defaultsettings.getValue("Default spindle speed (%)");defaultcut=defaultsettings.getValue("Default depth (mm)");defaultpasses=defaultsettings.getValue("Default passes (nr)");defaultgroup=defaultsettings.getValue("Default group").index;defaultbottomprofile=defaultsettings.getValue("Default bottom profile").index}function onMouseLeave(a){a.preventDefault()}
function onMouseUp(a){var c=cnccanvas[0].getBoundingClientRect();selecthandle(a.clientX-c.left,a.clientY-c.top);a.preventDefault()}function onMouseDown(a){a.preventDefault()}function onMouseMove(a){a.preventDefault()}
function selecthandle(a,c){var b,d,e=-1,f=9999;for(b=0;b<commands.length;b++){var k=commands[b][1];for(d=0;d<k.length;d++){var h=k[d][0]*sc;var g=k[d][1]*sc;h=Math.sqrt(Math.pow(a-h,2)+Math.pow(c-g,2));20>h&&h<f&&(e=b,f=h)}}e!==selhand&&(selhand=e,drawtocanvas("svgcanvas"),toggleselectedui())}
function OLD___selecthandle(a,c){var b,d=-1,e=9999;for(b=0;b<handles.length;b++){var f=handles[b][0];var k=handles[b][1];f=Math.sqrt(Math.pow(a-f,2)+Math.pow(c-k,2));20>f&&f<e&&(d=b,e=f)}d!==selhand&&(selhand=d,drawtocanvas("svgcanvas"),toggleselectedui())}
function toggleselectedui(){-1===selhand?(defaultsettings.show(),selectsettings.hide()):(stopchangedevents=!0,selectsettings.setValue("Include in cutting list",!1),selectsettings.setValue("Override defaults",!1),1===commands[selhand][6]&&selectsettings.setValue("Include in cutting list",!0),1===commands[selhand][8]&&selectsettings.setValue("Override defaults",!0),0===commands[selhand][6]?selectsettings.hideControl("Override defaults"):selectsettings.showControl("Override defaults"),defaultsettings.hide(),
selectsettings.show(),0===commands[selhand][8]?(selectsettings.hideControl("Override feed rate (mm/min)"),selectsettings.hideControl("Override spindle speed (%)"),selectsettings.hideControl("Override depth (mm)"),selectsettings.hideControl("Override passes (nr)"),selectsettings.hideControl("Override bottom profile"),selectsettings.hideControl("Override group")):(selectsettings.setValue("Override depth (mm)",commands[selhand][2]),selectsettings.setValue("Override passes (nr)",commands[selhand][3]),
selectsettings.setValue("Override feed rate (mm/min)",commands[selhand][4]),selectsettings.setValue("Override spindle speed (%)",commands[selhand][5]),selectsettings.setValue("Override bottom profile",commands[selhand][9]),selectsettings.setValue("Override group",commands[selhand][7]),selectsettings.showControl("Override feed rate (mm/min)"),selectsettings.showControl("Override spindle speed (%)"),selectsettings.showControl("Override passes (nr)"),0===cncmode?(selectsettings.showControl("Override bottom profile"),
selectsettings.showControl("Override depth (mm)")):(selectsettings.hideControl("Override bottom profile"),selectsettings.hideControl("Override depth (mm)")),selectsettings.showControl("Override group")),stopchangedevents=!1)}
function cutlistchanged(){-1!==selhand&&!0!==stopchangedevents&&(!1===selectsettings.getValue("Include in cutting list")?(commands[selhand][6]=0,commands[selhand][8]=0,selectsettings.setValue("Override defaults",!1),selectsettings.hideControl("Override defaults")):(commands[selhand][6]=1,selectsettings.showControl("Override defaults")),drawtocanvas("svgcanvas"))}
function overridechanged(){-1!==selhand&&!0!==stopchangedevents&&(!1===selectsettings.getValue("Override defaults")?(commands[selhand][8]=0,selectsettings.hideControl("Override feed rate (mm/min)"),selectsettings.hideControl("Override spindle speed (%)"),selectsettings.hideControl("Override depth (mm)"),selectsettings.hideControl("Override passes (nr)"),selectsettings.hideControl("Override bottom profile"),selectsettings.hideControl("Override group"),selectsettings.hideControl("Apply override values")):
(commands[selhand][8]=1,getdefaults(),commands[selhand][2]=defaultcut,commands[selhand][3]=defaultpasses,commands[selhand][4]=defaultfeed,commands[selhand][5]=defaultspeed,commands[selhand][9]=defaultbottomprofile,commands[selhand][7]=defaultgroup,selectsettings.showControl("Override feed rate (mm/min)"),selectsettings.showControl("Override spindle speed (%)"),selectsettings.showControl("Override passes (nr)"),0===cncmode?(selectsettings.showControl("Override bottom profile"),selectsettings.showControl("Override depth (mm)")):
(selectsettings.hideControl("Override bottom profile"),selectsettings.hideControl("Override depth (mm)")),selectsettings.showControl("Override group"),selectsettings.showControl("Apply override values"),selectsettings.setValue("Override depth (mm)",defaultcut),selectsettings.setValue("Override passes (nr)",defaultpasses),selectsettings.setValue("Override feed rate (mm/min)",defaultfeed),selectsettings.setValue("Override spindle speed (%)",defaultspeed),selectsettings.setValue("Override bottom profile",
defaultbottomprofile),selectsettings.setValue("Override group",defaultgroup),selectsettings.show()))}function reverseselectedpath(){var a,c=[];if(-1!==selhand){var b=commands[selhand][1];for(a=0;a<b.length;a++)c.push([b[b.length-(a+1)][0],b[b.length-(a+1)][1]]);commands[selhand][1]=c;drawtocanvas("svgcanvas")}}
function layoutapp(){var a=0;var c=cnccanvas[0].getContext("2d");var b=$("#appcontainer").width();var d=$("#appcontainer").outerHeight()-$("#appnav").outerHeight()-10;if(!1!==loaded){b-=280;var e=(b-10)/(xmax-xmin);e*=ymax-ymin;e>d-10&&(d=(d-10)/e,a=b,b*=d,a=parseInt(a-b)/2,e*=d);e+=10;b=parseInt(b);e=parseInt(e);c.canvas.width=b;c.canvas.height=e;c.canvas.style.top="5px";c.canvas.style.left=260+a+"px";drawtocanvas("svgcanvas")}}function onResize(a){layoutapp()}
function setcncmode(a){if(cncmode!==a)switch(a){case 0:cncmode=0;$("#safezdiv").show();defaultsettings.showControl("Default depth (mm)");selectsettings.showControl("Override depth (mm)");defaultsettings.showControl("Default bottom profile");selectsettings.showControl("Override bottom profile");document.getElementById("rmode").text="\u2713 Router mode (with depth)";document.getElementById("lmode").text="LASER mode (no depth)";break;case 1:cncmode=1,$("#safezdiv").hide(),defaultsettings.hideControl("Default depth (mm)"),
selectsettings.hideControl("Override depth (mm)"),defaultsettings.hideControl("Default bottom profile"),selectsettings.hideControl("Override bottom profile"),document.getElementById("rmode").text="Router mode (with depth)",document.getElementById("lmode").text="\u2713 LASER mode (no depth)"}}
function setcncorigin(a){var c;if(a!==originpos){originpos=a;for(c=0;5>c;c++)c===a?document.getElementById("origin"+c).text="\u2713 "+origintexts[c]:document.getElementById("origin"+c).text=origintexts[c];drawtocanvas("svgcanvas")}}function setsvgtexts(){$("#ncwidth").val(cutterwidth.toFixed(0));$("#ncheight").val(cutterheight.toFixed(0));$("#svgncwidth").val(cutterwidth.toFixed(0));$("#svgncheight").val(cutterheight.toFixed(0))}
function generategcode(){var a,c=!1;var b=parseFloat($("#ncwidth").val());var d=parseFloat($("#ncheight").val());var e=parseFloat($("#safez").val());grblmode=a=$("#grblmode").prop("selectedIndex");0<b&&0<d&&0<=e&&100>=e&&!isNaN(b)&&!isNaN(d)&&!isNaN(e)&&(c=!0);!1===c?$("#gcodeerror").show():(maxspeed=0===a?1E3:255,cutterwidth=b,cutterheight=d,safez=e,downloadcncfile(),savesettingslocally(),$("#savegcodefiledialog").modal("hide"))}
function opengcodedialog(){setsvgtexts();$("#grblmode option")[grblmode].selected=!0;$("#safez").val(safez);$("#gcodeerror").hide();$("#savegcodefiledialog").modal("show")}function openimportdialog(){$("#svgfile").val("");$("#importbutton").hide();$("#importsvgfiledialog").modal("show")}function opensvgexportdialog(){setsvgtexts();$("#svgexporterror").hide();$("#savesvgfiledialog").modal("show")}
function generatesvgexport(){var a=!1;var c=parseFloat($("#svgncwidth").val());var b=parseFloat($("#svgncheight").val());0<c&&0<b&&!isNaN(c)&&!isNaN(b)&&(a=!0);!1===a?$("#svgexporterror").show():(cutterwidth=c,cutterheight=b,downloadsvgfile(),$("#savesvgfiledialog").modal("hide"))}function svgfilechanged(){""!==$("#svgfile").val()?$("#importbutton").show():$("#importbutton").hide()}
function getQueryVariable(a){for(var c=window.location.search.substring(1).split("&"),b=0;b<c.length;b++){var d=c[b].split("=");if(d[0]==a)return d[1]}return!1}function downloadsvgfile(){var a=filename+"_cnc.svg",c=makecncsvgexport();a=new File([c],a,{type:"text/plain;charset=utf-8"});saveAs(a)}function dialogwidthchanged(a,c){var b=parseFloat($("#"+a).val().replace(/\D/g,""))*(1/cutteraspect);$("#"+c).val(b.toFixed(0))}
function dialogheightchanged(a,c){var b=parseFloat($("#"+c).val().replace(/\D/g,""))*cutteraspect;$("#"+a).val(b.toFixed(0))}function opensamplesdialog(a){setsampledescription(a);$("#samplesbody").scrollTop(0);$("#samplesdialog").modal("show")}
function makethemesdropdown(){var a,c="";for(a=0;a<themes.length;a++){var b=themes[a][0];a===theme&&(b="\u2713 "+b);c+='<a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" ';c+='onclick="changetheme('+a+')">'+b+"</a>"}$("#themesdropdownitems").html(c)}
function makesamplesdropdown(){var a,c="";for(a=0;a<svgsamples.length;a++){var b=svgsamples[a][0];var d="./images/th_"+svgsamples[a][1]+".png";c+='<a class="dropdown-item navbardropdownitems" href="#" data-toggle="modal" ';c+='onclick="opensamplesdialog('+a+')">';c+='<img src="'+d+'" width="75" style="padding-right: 10px;"/>';c+=b+"</a>"}$("#samplesdropdownitems").html(c)}
function setsampledescription(a){var c="";var b=svgsamples[a][0];var d=parseInt(svgsamples[a][2]);var e=parseInt(svgsamples[a][3]);var f=parseInt(svgsamples[a][4]);var k=parseInt(svgsamples[a][5]);var h=svgsamples[a][6];var g=svgsamples[a][7];var q=svgsamples[a][8];tempsample=a;$("#samplename").html(b);0===d&&(c+='<p class="sampledesctext"><b>Project type:</b> Router</p>');1===d&&(c+='<p class="sampledesctext"><b>Project type:</b> LASER</p>');2===d&&(c+='<p class="sampledesctext"><b>Project type:</b> Router or LASER</p>');
0===e&&(c+='<p class="sampledesctext"><b>Skill level:</b> Beginner</p>');1===e&&(c+='<p class="sampledesctext"><b>Skill level:</b> Intermediate</p>');2===e&&(c+='<p class="sampledesctext"><b>Skill level:</b> Advanced</p>');c=c+('<p class="sampledesctext"><b>Dimensions (WxH):</b> '+f+"mm x "+k+"mm</p>")+('<p class="sampledesctext"><b>Description:</b> '+g+"</p>");""!==q&&(c=c+('<p><a href="'+q+'" target="_blank">')+"Click here to visit the web page for this project (link opens in a new tab).",c+="</a></p>");
c+="<p>"+h+"</p>";$("#samplesdescription").html(c);$("#gcodercncsvg").attr("width",400);$("#gcodercncsvg").attr("height",k/f*400);$("#gcodercncsvg").attr("preserveAspectRatio","xMinYMin meet");$("#gcodercncsvg").attr("viewBox","-5 -5 "+(f+10)+" "+(k+10));$("#gcodercncsvg").attr("style",canvascol)}function openthissample(){$("#samplesdialog").modal("hide");loadsample(tempsample)}
function overridevalueschanged(){commands[selhand][3]=selectsettings.getValue("Override passes (nr)");commands[selhand][4]=selectsettings.getValue("Override feed rate (mm/min)");commands[selhand][5]=selectsettings.getValue("Override spindle speed (%)");commands[selhand][7]=selectsettings.getValue("Override group").index;0===cncmode?(commands[selhand][2]=selectsettings.getValue("Override depth (mm)"),commands[selhand][9]=selectsettings.getValue("Override bottom profile").index):(commands[selhand][2]=
defaultcut,commands[selhand][9]=defaultbottomprofile)}function refreshwebapp(){setTimeout(function(){window.location.reload(!0)},100)}function onUnloading(a){savesettingslocally()}function savesettingslocally(){window.localStorage&&(window.localStorage.setItem("grblmode",grblmode),window.localStorage.setItem("safez",safez),window.localStorage.setItem("theme",theme))}
function loadsettingslocally(){var a=window.localStorage.getItem("safez");null===a||isNaN(a)||(safez=parseFloat(a));a=window.localStorage.getItem("grblmode");null===a||isNaN(a)||(grblmode=parseInt(a));a=window.localStorage.getItem("theme");null===a||isNaN(a)||(theme=parseInt(a))}
function makecncsvgexport(){var a,c,b="";getdefaults();var d=cutterwidth/(xmax-xmin),e=cutterheight/(ymax-ymin);switch(originpos){case 0:originy=originx=0;break;case 1:originx=0;originy=cutterheight;break;case 2:originx=cutterwidth;originy=0;break;case 3:originx=cutterwidth;originy=cutterheight;break;case 4:originx=cutterwidth/2,originy=cutterheight/2}b=b+'<?xml version="1.0" encoding="utf-8"?>\r\n'+('<svg id="gcodercncsvg" width="'+cutterwidth+'px" height="'+cutterheight+'px" style="background-color:#FFFFFF" version="1.1" ');
b+='xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" >\r\n';for(a=0;a<commands.length;a++)if("L"===commands[a][0]&&1===commands[a][6]){var f=commands[a][1];f=scaletoolpath(f,d,e,cutterheight);f=simplifytoolpath(f,arcdist);b+='  <path d="M ';for(c=0;c<f.length;c++){var k=f[c][0]-originx;var h=cutterheight-f[c][1]-originy;b+=k.toFixed(3)+","+h.toFixed(3)+" "}b+='" opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-dasharray="none" fill-opacity="0" />\r\n'}b+=
"</svg>\r\n";145E4<b.length&&alert("File size may prohibit download!");return b}
function makecnctext(){var a,c,b,d,e,f,k="";getdefaults();var h=Math.floor(G0feedrate*maxspeed);var g=defaultpasses;for(a=0;a<commands.length;a++)1===commands[a][8]&&commands[a][3]>g&&(g=commands[a][3]);var q=cutterwidth/(xmax-xmin),l=cutterheight/(ymax-ymin);switch(originpos){case 0:originy=originx=0;break;case 1:originx=0;originy=cutterheight;break;case 2:originx=cutterwidth;originy=0;break;case 3:originx=cutterwidth;originy=cutterheight;break;case 4:originx=cutterwidth/2,originy=cutterheight/2}k+=
"G21\r\nG17\r\nG90\r\n";k=0===cncmode?k+("G0 X0 Y0 Z0 F"+h+" S0\r\n")+"M3\r\n":k+"M5\r\n"+("G0 X0 Y0 F"+h+" S0\r\n");var p=e=0;k+="G91\r\n";for(d=0;5>d;d++)for(b=0;b<g;b++)for(a=0;a<commands.length;a++)if("L"===commands[a][0]&&1===commands[a][6]){if(0===commands[a][8]){var m=defaultcut;var n=defaultpasses;var r=defaultfeed;var t=Math.floor(defaultspeed/100*maxspeed);var u=defaultgroup}else m=commands[a][2],n=commands[a][3],r=commands[a][4],t=Math.floor(commands[a][5]/100*maxspeed),u=commands[a][7];
0===cncmode&&(c=(b+1)/n*m);1===cncmode&&(c=0);if(b<n&&u===d){var v=maketoolpath(a,c,m,q,l,cutterheight);for(n=f=0;n<v.length;n++){var w=v[n][0];var x=v[n][1];m=w-originx-e;u=x-originy-p;var y=v[n][2]-f;e=w-originx;p=x-originy;f=v[n][2];0===n?(k+="G0 X"+m.toFixed(3)+" Y"+u.toFixed(3)+" F"+h+" S"+t+"\r\n",k+="G0 F"+r+" S"+t+"\r\n",0===cncmode&&(k+="G0 Z-"+safez+"\r\n"),1===cncmode&&(k+="G0 Z-"+c+"\r\n"),k+="G0 Z"+y.toFixed(3)+"\r\n",1===cncmode&&(k+="M3\r\n")):k+="G1 X"+m.toFixed(3)+" Y"+u.toFixed(3)+
" Z"+y.toFixed(3)+"\r\n"}1===cncmode&&(k+="M5\r\n");k+="G90\r\nG0 Z0\r\nG91\r\n"}}k+="G90\r\nG0 X0 Y0\r\n";0===cncmode&&(k+="M5\r\n");k+="M2\r\n";145E4<k.length&&alert("File size may prohibit download!");return k}
function maketoolpath(a,c,b,d,e,f){var k=0,h=0;var g=commands[a][1];g=scaletoolpath(g,d,e,f);g=simplifytoolpath(g,arcdist);d=-1!==commands[a][9]?commands[a][9]:defaultbottomprofile;0!==d&&(g=pathtoarcdistance(g));e=pathlength(g);for(a=0;a<g.length;a++)switch(0<a&&(k+=mag(g[a][0]-g[a-1][0],g[a][1]-g[a-1][1]),h=k/e),d){case 0:g[a][2]=b;break;case 1:g[a][2]=.5>h?2*b*h:2*b*(1-h);break;case 2:g[a][2]=.5>h?b-2*b*h:b-2*b*(1-h);break;case 3:g[a][2]=b*Math.sin(h*Math.PI);break;case 4:g[a][2]=b-b*Math.sin(h*
Math.PI);break;case 5:g[a][2]=b*h;break;case 6:g[a][2]=b-b*h;break;case 7:g[a][2]=b*Math.sin(h*Math.PI/2);break;case 8:g[a][2]=b-b*Math.sin(h*Math.PI/2);break;case 9:g[a][2]=.1>h?10*b*h:.9<h?10*b*(1-h):b}for(a=0;a<g.length;a++)g[a][2]>c&&(g[a][2]=c);for(a=0;a<g.length;a++)g[a][2]*=-1;return g}function scaletoolpath(a,c,b,d){var e,f=[];for(e=0;e<a.length;e++){var k=a[e][0]*c;var h=d-a[e][1]*b;f.push([k,h,0])}return f}
function simplifytoolpath(a,c){var b,d=a[0][0],e=a[0][1],f=[];for(b=0;b<a.length;b++){var k=a[b][0];var h=a[b][1];if(0===b||b===a.length-1)f.push([k,h,0]);else{var g=Math.sqrt(Math.pow(k-d,2)+Math.pow(h-e,2));var q=a[b+1][0];var l=a[b+1][1];q=Math.sqrt(Math.pow(k-q,2)+Math.pow(h-l,2));if(g>=c||q>=10*c)f.push([k,h,0]),d=k,e=h}}return f}
function pathtoarcdistance(a){var c,b,d=0,e=[];if(2>a.length)return a;e.push(a[0]);for(c=1;c<a.length;c++){var f=mag(a[c][0]-a[c-1][0],a[c][1]-a[c-1][1]);if(d+f<arcdist)d+=f;else{var k=a[c-1][0];var h=a[c-1][1];var g=a[c][0]-k;var q=a[c][1]-h;var l=(f-d)/arcdist;for(b=0;b<=Math.floor(l);b++){var p=(d+b*arcdist)/f;var m=k+p*g;p=h+p*q;e.push([m,p,0])}d=f-(Math.floor(l)*arcdist+d)}}e.push(a[a.length-1]);return e}
function cleansvg(){var a,c="";svgin=svgin.replace(/[\n\r]+/g,"");svgin=svgin.trim();svgin=svgin.replace(/     /g," ");svgin=svgin.replace(/    /g," ");svgin=svgin.replace(/   /g," ");svgin=svgin.replace(/  /g," ");svgin=svgin.replace(/<  /g,"<");svgin=svgin.replace(/  >/g,">");svgin=svgin.replace(/ >/g,">");svgin=svgin.replace(/defs \//g,"defs/");svgin=svgin.replace(/>/g,">\n");if(svgin.includes("<defs")){var b=a=1;var d=svgin.indexOf("<defs");if(svgin.includes("</defs>"))var e=svgin.indexOf("</defs>")+
6;else for(;d+b<svgin.length;){var f=svgin.charAt(d+b);"<"===f&&a++;">"===f&&a--;if(0===a){e=d+b;break}b++}svgin=svgin.substring(0,d-1)+svgin.substring(e+1,svgin.length-1)}a=svgin.split("\n");for(d=0;d<a.length;d++){f=!1;for(e=0;e<svgcommands.length;e++)a[d].includes(svgcommands[e])&&(f=!0);!0===f&&(c+=a[d]+"\n")}svgin=c}
function parsesvg(){var a=svgin.replace('<?xml version="1.0" encoding="utf-8"?>',"");if(window.DOMParser){var c=new DOMParser;c=c.parseFromString(a,"image/svg+xml");if(c.hasChildNodes())for(a=c.childNodes,c=0;c<a.length;c++)"defs"!==a[c].nodeName&&parseelement(a[c])}}
function parseelement(a){var c;var b=a.nodeName;if(!0===a.hasChildNodes()){if("g"===b){var d=a.getAttribute("transform");a.getAttribute("stroke");a.getAttribute("stroke-width");null!==d&&transforms.push(gettransform(d))}var e=a.childNodes;for(c=0;c<e.length;c++)parseelement(e[c]);"g"===b&&null!==d&&transforms.pop()}if("path"===b)for(c=a.getAttribute("d").trim(),c=cleanpath(c),d=splitcompoundpath(c),c=0;c<d.length;c++)0===c?dopathelement(a,d[c],!1):dopathelement(a,d[c],!0);else"rect"===b?dorectelement(a):
"circle"===b?docircleelement(a):"ellipse"===b?doellipseelement(a):"line"===b?dolineelement(a):"polygon"===b?dopolygonelement(a):"polyline"===b?dopolylineelement(a):"image"===b?doimageelement(a):dounknownelement(a)}function dounknownelement(a){}function parseMyFloat(a){var c=null;null!==a&&(c=parseFloat(a),a.includes("e")||a.includes("E"))&&(c=parseFloat(c.toFixed(10)));return c}
function splitcompoundpath(a){a=a.replace(/M/g,"*M");a=a.replace(/m/g,"*m");"*"===a[0]&&(a=a.substring(1));var c=a.split("*");for(a=0;a<c.length;a++)c[a]=c[a].replace(/,\s*$/,"");return c}
function cleanpath(a){a=a.replace(/M/g," M");a=a.replace(/L/g," L");a=a.replace(/H/g," H");a=a.replace(/V/g," V");a=a.replace(/C/g," C");a=a.replace(/S/g," S");a=a.replace(/Q/g," Q");a=a.replace(/T/g," T");a=a.replace(/A/g," A");a=a.replace(/m/g," m");a=a.replace(/l/g," l");a=a.replace(/h/g," h");a=a.replace(/v/g," v");a=a.replace(/c/g," c");a=a.replace(/s/g," s");a=a.replace(/q/g," q");a=a.replace(/t/g," t");a=a.replace(/a/g," a");a=a.replace(/\t/g,"");a=a.replace(/  +/g," ");a=a.replace(/M /g,"M");
a=a.replace(/L /g,"L");a=a.replace(/H /g,"H");a=a.replace(/V /g,"V");a=a.replace(/C /g,"C");a=a.replace(/S /g,"S");a=a.replace(/Q /g,"Q");a=a.replace(/T /g,"T");a=a.replace(/A /g,"A");a=a.replace(/M/g,"M,");a=a.replace(/L/g,"L,");a=a.replace(/H/g,"H,");a=a.replace(/V/g,"V,");a=a.replace(/C/g,"C,");a=a.replace(/S/g,"S,");a=a.replace(/Q/g,"Q,");a=a.replace(/T/g,"T,");a=a.replace(/A/g,"A,");a=a.replace(/m /g,"m");a=a.replace(/l /g,"l");a=a.replace(/h /g,"h");a=a.replace(/v /g,"v");a=a.replace(/c /g,
"c");a=a.replace(/s /g,"s");a=a.replace(/q /g,"q");a=a.replace(/t /g,"t");a=a.replace(/a /g,"a");a=a.replace(/m/g,"m,");a=a.replace(/l/g,"l,");a=a.replace(/h/g,"h,");a=a.replace(/v/g,"v,");a=a.replace(/c/g,"c,");a=a.replace(/s/g,"s,");a=a.replace(/q/g,"q,");a=a.replace(/t/g,"t,");a=a.replace(/a/g,"a,");a=a.replace(/ /g,",");","===a[0]&&(a=a.substring(1));return a}
function dopathelement(a,c,b){var d=0,e=0,f=1,k=!0;!1===b&&(lasty=lastx=0);"none"===a.getAttribute("stroke")&&(f=0);if(!(2>c.length)){parseInt(a.getAttribute("stroke-width"));a=a.getAttribute("transform");var h=gettransform(a);b=c.split(",");a=0;for(points=[];a<b.length;){var g=!0;var q=b[a];if("m"===b[a]||"l"===b[a]||"h"===b[a]||"v"===b[a]||"c"===b[a]||"s"===b[a]||"q"===b[a]||"t"===b[a]||"a"===b[a])b[a]=b[a].toUpperCase(),g=!1;if("M"===b[a]){if(!0===g){var l=parseMyFloat(b[a+1]);var p=parseMyFloat(b[a+
2])}else l=lastx+parseMyFloat(b[a+1]),p=lasty+parseMyFloat(b[a+2]);var m=dotransforms(l,p,h);!0===k?(k=!1,points.push([m[0],m[1]]),d=m[0],e=m[1],lastx=l,lasty=p,a+=3):a=b.length}else if("L"===b[a])!0===g?(l=parseMyFloat(b[a+1]),p=parseMyFloat(b[a+2])):(l=lastx+parseMyFloat(b[a+1]),p=lasty+parseMyFloat(b[a+2])),m=dotransforms(l,p,h),points.push([m[0],m[1]]),lastx=l,lasty=p,a+=3;else if("H"===b[a])l=!0===g?parseMyFloat(b[a+1]):lastx+parseMyFloat(b[a+1]),p=lasty,m=dotransforms(l,p,h),points.push([m[0],
m[1]]),lastx=l,lasty=p,a+=2;else if("V"===b[a])l=lastx,p=!0===g?parseMyFloat(b[a+1]):lasty+parseMyFloat(b[a+1]),m=dotransforms(l,p,h),points.push([m[0],m[1]]),lastx=l,lasty=p,a+=2;else if("A"===b[a]){l=parseMyFloat(b[a+1]);p=parseMyFloat(b[a+2]);m=parseMyFloat(b[a+3]);var n=parseInt(b[a+4]);var r=parseInt(b[a+5]);if(!0===g){g=parseMyFloat(b[a+6]);var t=parseMyFloat(b[a+7])}else g=lastx+parseMyFloat(b[a+6]),t=lasty+parseMyFloat(b[a+7]);l=drawpatharc(lastx,lasty,l,p,m,n,r,g,t,h);lastx=l[0];lasty=l[1];
a+=8}else"Q"===b[a]?(!0===g?(l=parseMyFloat(b[a+1]),p=parseMyFloat(b[a+2]),m=parseMyFloat(b[a+3]),n=parseMyFloat(b[a+4])):(l=lastx+parseMyFloat(b[a+1]),p=lasty+parseMyFloat(b[a+2]),m=lastx+parseMyFloat(b[a+3]),n=lasty+parseMyFloat(b[a+4])),l=drawquadraticcurve(lastx,lasty,l,p,m,n,h),lastx=l[0],lasty=l[1],a+=5):"C"===b[a]?(!0===g?(l=parseMyFloat(b[a+1]),p=parseMyFloat(b[a+2]),m=parseMyFloat(b[a+3]),n=parseMyFloat(b[a+4]),r=parseMyFloat(b[a+5]),g=parseMyFloat(b[a+6])):(l=lastx+parseMyFloat(b[a+1]),
p=lasty+parseMyFloat(b[a+2]),m=lastx+parseMyFloat(b[a+3]),n=lasty+parseMyFloat(b[a+4]),r=lastx+parseMyFloat(b[a+5]),g=lasty+parseMyFloat(b[a+6])),l=drawcubicbezier(lastx,lasty,l,p,m,n,r,g,h),lastx=l[0],lasty=l[1],a+=7):"S"===b[a]?a+=5:"T"===b[a]?a+=3:("Z"===b[a]||"z"===b[a]?points.push([d,e]):(console.log("Path unknown command : '"+b[a]+"' ("+b[a].charCodeAt(0)+")"),console.log(c.length),console.log(c)),a++);0<a&&a<b.length&&!"MmLlHhVvCcSsQqTtAaZz".includes(b[a])&&("M"===q&&(q="L"),"m"===q&&(q="l"),
a--,b[a]=q)}commands.push(["L",points,-1,-1,-1,-1,f,-1,0,-1,0,0])}}
function dorectelement(a){var c=1;"none"===a.getAttribute("stroke")&&(c=0);var b=parseMyFloat(a.getAttribute("x")),d=parseMyFloat(a.getAttribute("y")),e=parseMyFloat(a.getAttribute("width")),f=parseMyFloat(a.getAttribute("height")),k=parseMyFloat(a.getAttribute("rx")),h=parseMyFloat(a.getAttribute("ry"));null===k&&null!==h&&(k=h);null!==k&&null===h&&(h=k);parseInt(a.getAttribute("stroke-width"));a=a.getAttribute("transform");var g=gettransform(a);points=[];null===k||null===h||isNaN(k)||isNaN(h)?(a=
dotransforms(b,d,g),points.push([a[0],a[1]]),a=dotransforms(b+e,d,g),points.push([a[0],a[1]]),a=dotransforms(b+e,d+f,g),points.push([a[0],a[1]]),a=dotransforms(b,d+f,g),points.push([a[0],a[1]]),a=dotransforms(b,d,g)):(drawarc(b+k,d+h,k,h,270,90,1,g),a=dotransforms(b+k,d,g),points.push([a[0],a[1]]),a=dotransforms(b+e-k,d,g),points.push([a[0],a[1]]),drawarc(b+e-k,d+h,k,h,0,90,1,g),a=dotransforms(b+e,d+h,g),points.push([a[0],a[1]]),a=dotransforms(b+e,d+f-h,g),points.push([a[0],a[1]]),drawarc(b+e-k,d+
f-h,k,h,90,90,1,g),a=dotransforms(b+e-k,d+f,g),points.push([a[0],a[1]]),a=dotransforms(b+k,d+f,g),points.push([a[0],a[1]]),drawarc(b+k,d+f-h,k,h,180,90,1,g),a=dotransforms(b,d+f-h,g),points.push([a[0],a[1]]),a=dotransforms(b,d+h,g));points.push([a[0],a[1]]);commands.push(["L",points,-1,-1,-1,-1,c,-1,0,-1,0,0])}
function docircleelement(a){var c=1;"none"===a.getAttribute("stroke")&&(c=0);var b=parseMyFloat(a.getAttribute("cx")),d=parseMyFloat(a.getAttribute("cy")),e=parseMyFloat(a.getAttribute("r"));parseInt(a.getAttribute("stroke-width"));a=a.getAttribute("transform");a=gettransform(a);points=[];drawarc(b,d,e,e,0,360,1,a);commands.push(["L",points,-1,-1,-1,-1,c,-1,0,-1,0,0])}
function doellipseelement(a){var c=1;"none"===a.getAttribute("stroke")&&(c=0);var b=parseMyFloat(a.getAttribute("cx")),d=parseMyFloat(a.getAttribute("cy")),e=parseMyFloat(a.getAttribute("rx")),f=parseMyFloat(a.getAttribute("ry"));parseInt(a.getAttribute("stroke-width"));a=a.getAttribute("transform");a=gettransform(a);points=[];drawarc(b,d,e,f,0,360,1,a);commands.push(["L",points,-1,-1,-1,-1,c,-1,0,-1,0,0])}
function dolineelement(a){var c=1;"none"===a.getAttribute("stroke")&&(c=0);var b=parseMyFloat(a.getAttribute("x1"));var d=parseMyFloat(a.getAttribute("y1")),e=parseMyFloat(a.getAttribute("x2")),f=parseMyFloat(a.getAttribute("y2"));parseInt(a.getAttribute("stroke-width"));a=a.getAttribute("transform");a=gettransform(a);points=[];b=dotransforms(b,d,a);points.push([b[0],b[1]]);b=dotransforms(e,f,a);points.push([b[0],b[1]]);commands.push(["L",points,-1,-1,-1,-1,c,-1,0,-1,0,0])}
function dopolygonelement(a){var c=1;"none"===a.getAttribute("stroke")&&(c=0);var b=a.getAttribute("points");parseInt(a.getAttribute("stroke-width"));a=a.getAttribute("transform");a=gettransform(a);var d=b.split(",");points=[];for(b=0;b<d.length;b+=2){var e=parseMyFloat(d[b]);var f=parseMyFloat(d[b+1]);e=dotransforms(e,f,a);if(0===b){points.push([e[0],e[1]]);var k=e[0];var h=e[1]}else points.push([e[0],e[1]])}points.push([k,h]);commands.push(["L",points,-1,-1,-1,-1,c,-1,0,-1,0,0])}
function dopolylineelement(a){var c=1;"none"===a.getAttribute("stroke")&&(c=0);var b=a.getAttribute("points");parseInt(a.getAttribute("stroke-width"));a=a.getAttribute("transform");a=gettransform(a);var d=b.split(",");points=[];for(b=0;b<d.length;b+=2){var e=parseMyFloat(d[b]);var f=parseMyFloat(d[b+1]);e=dotransforms(e,f,a);points.push([e[0],e[1]])}commands.push(["L",points,-1,-1,-1,-1,c,-1,0,-1,0,0])}
function doimageelement(a){parseMyFloat(a.getAttribute("x"));parseMyFloat(a.getAttribute("y"));parseMyFloat(a.getAttribute("width"));parseMyFloat(a.getAttribute("height"));parseMyFloat(a.getAttribute("xlink:href"));console.log("IMAGE")}
function drawarc(a,c,b,d,e,f,k,h){e=e/180*Math.PI;var g=Math.abs(f/180*Math.PI),q=g/1E4;for(f=0;f<=g;f+=q){var l=e+f*k;0>l&&(l+=2*Math.PI);l>2*Math.PI&&(l-=2*Math.PI);var p=a+b*Math.sin(l);l=c-d*Math.cos(l);if(0===f||dist(m,n,p,l)>arcdist||f>=g){var m=dotransforms(p,l,h);points.push([m[0],m[1]]);m=p;var n=l}}return[m,n]}
function drawquadraticcurve(a,c,b,d,e,f,k){var h,g,q=g=0;for(h=0;1E3>=h;h++){var l=h/1E3;var p=Math.pow(1-l,2)*a+2*(1-l)*l*b+Math.pow(l,2)*e;l=Math.pow(1-l,2)*c+2*(1-l)*l*d+Math.pow(l,2)*f;if(0===h||dist(g,q,p,l)>arcdist||999===h)g=dotransforms(p,l,k),points.push([g[0],g[1]]),g=p,q=l}return[g,q]}
function drawpatharc(a,c,b,d,e,f,k,h,g,q){var l=a;var p=c;e=e/180*Math.PI;var m=Math.cos(e)*(a-h)/2+Math.sin(e)*(c-g)/2;var n=-Math.sin(e)*(a-h)/2+Math.cos(e)*(c-g)/2;var r=Math.pow(m,2)/Math.pow(b,2)+Math.pow(n,2)/Math.pow(d,2);1<r&&(b*=Math.sqrt(r),d*=Math.sqrt(r));r=(f==k?-1:1)*Math.sqrt((Math.pow(b,2)*Math.pow(d,2)-Math.pow(b,2)*Math.pow(n,2)-Math.pow(d,2)*Math.pow(m,2))/(Math.pow(b,2)*Math.pow(n,2)+Math.pow(d,2)*Math.pow(m,2)));isNaN(r)&&(r=0);f=r*b*n/d;r=r*-d*m/b;a=(a+h)/2+Math.cos(e)*f-Math.sin(e)*
r;g=(c+g)/2+Math.sin(e)*f+Math.cos(e)*r;var t=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))*Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)))},u=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(t(a,b))};c=u([1,0],[(m-f)/b,(n-r)/d]);h=[(m-f)/b,(n-r)/d];m=[(-m-f)/b,(-n-r)/d];n=u(h,m);-1>=t(h,m)&&(n=Math.PI);1<=t(h,m)&&(n=0);k=1==k?1:-1;h=n/1E4;for(m=0;1E4>=m;m++)if(f=c+m*Math.abs(h)*k,0>f&&(f+=2*Math.PI),f>2*Math.PI&&(f-=2*Math.PI),n=b*Math.cos(f),f=d*Math.sin(f),
0!==e&&e!==2*Math.PI&&(f=rotatepoint(n,f,e),n=f[0],f=f[1]),n+=a,f+=g,dist(l,p,n,f)>arcdist||0===m||1E4===m)l=dotransforms(n,f,q),points.push([l[0],l[1]]),l=n,p=f;return[l,p]}
function drawcubicbezier(a,c,b,d,e,f,k,h,g){var q;var l=a;var p=c;for(q=0;1E3>=q;q++){var m=q/1E3;var n=Math.pow(1-m,3);var r=3*m*Math.pow(1-m,2);var t=3*Math.pow(m,2)*(1-m);var u=Math.pow(m,3);m=n*a+r*b+t*e+u*k;n=n*c+r*d+t*f+u*h;if(dist(l,p,m,n)>arcdist||0===q||1E3===q)l=dotransforms(m,n,g),points.push([l[0],l[1]]),l=m,p=n}return[l,p]}function parseMyFloat(a){var c=null;null!==a&&(c=parseFloat(a),a.includes("e")||a.includes("E"))&&(c=parseFloat(c.toFixed(10)));return c}
function gettransform(a){var c=[0,0],b=[1,1],d=[0,0,0];if(null!==a){var e=a.search("translate");if(-1!=e){var f=a.substring(e+10);e=f.search("\\)");f=f.substring(0,e);c=f.split(" ").join(",").split(",")}e=a.search("scale");-1!=e&&(f=a.substring(e+6),e=f.search("\\)"),f=f.substring(0,e),b=f.split(" ").join(",").split(","),1===b.length&&(b=[b,b]));e=a.search("rotate");-1!=e&&(f=a.substring(e+7),e=f.search("\\)"),f=f.substring(0,e),d=f.split(" ").join(",").split(","))}return[parseFloat(c[0]),parseFloat(c[1]),
parseFloat(b[0]),parseFloat(b[1]),parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])]}function dotransforms(a,c,b){c=applytransform(a,c,b);if(0<transforms.length)for(a=transforms.length-1;0<=a;a--)c=applytransform(c[0],c[1],transforms[a]);return c}function applytransform(a,c,b){a*=b[2];var d=c*b[3];0!=b[4]&&(c=mag(a-b[5],d-b[6]),d=getangle(a-b[5],d-b[6]),d-=Math.PI/180*b[4],a=c*Math.sin(d),d=c*Math.cos(d),a+=b[5],d+=b[6]);a+=b[0];d+=b[1];return[a,d]}
function getangle(a,c){if(0==a&&0==c)return 0;var b=Math.atan(a/c);0>b&&(b*=-1);return 0<=a&&0<=c?b:0<=a&&0>=c?Math.PI-b:0>=a&&0>=c?Math.PI+b:0>=a&&0<=c?2*Math.PI-b:0}function mag(a,c){return Math.sqrt(a*a+c*c)}function pathlength(a){var c,b=0;if(1<a.length)for(c=1;c<a.length;c++)b+=mag(a[c][0]-a[c-1][0],a[c][1]-a[c-1][1]);return b}
function getbounds(){var a,c;xmin=999999999;xmax=-999999999;ymin=999999999;ymax=-999999999;for(a=0;a<commands.length;a++)if("L"===commands[a][0]){var b=commands[a][1];for(c=0;c<b.length;c++){var d=b[c][0];var e=b[c][1];d<xmin&&(xmin=d);d>xmax&&(xmax=d);e<ymin&&(ymin=e);e>ymax&&(ymax=e)}}}
function moveto(a,c){var b,d;var e=xmin-a;var f=ymin-c;for(b=0;b<commands.length;b++)if("L"===commands[b][0]){var k=commands[b][1];for(d=0;d<k.length;d++){var h=k[d][0];var g=k[d][1];k[d][0]=h-e;k[d][1]=g-f}}xmin=a;ymin=c;xmax-=e;ymax-=f}function scaleto(a,c){var b=a/(xmax-xmin),d=c/(ymax-ymin);scale(b<d?b:d)}
function scale(a){var c,b;for(c=0;c<commands.length;c++)if("L"===commands[c][0]){var d=commands[c][1];for(b=0;b<d.length;b++){var e=d[b][0];var f=d[b][1];d[b][0]=e*a;d[b][1]=f*a}}xmin=Math.floor(xmin*a);ymin=Math.floor(ymin*a);xmax=Math.floor(xmax*a);ymax=Math.floor(ymax*a)}function rgb2mono(a,c,b){return Math.floor(.2126*a)+.7152*c+.0722*b}function dist(a,c,b,d){return Math.sqrt(Math.pow(b-a,2)+Math.pow(d-c,2))}
function rotatepoint(a,c,b){var d=getangle(a,c);a=mag(a,c);return[a*Math.sin(d-b),a*Math.cos(d-b)]};